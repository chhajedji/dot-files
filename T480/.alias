#!/bin/bash

[ -n "$EDITOR" ] || EDITOR="vi"

# General alias

alias ea="$EDITOR $HOME/.alias"
alias ev="$EDITOR $HOME/.vimrc"
alias ebp="$EDITOR $HOME/.bashrc"
alias ep="$EDITOR $HOME/.profile"
# alias exr="$EDITOR $HOME/.Xresources"
alias SB="source $HOME/.bashrc"
alias SA="source $HOME/.alias"
# alias p2="python2"
# alias p3="python3 -q"
alias v="vim +"
alias make="make -j32"
# alias make="colormake"       # `sudo apt install colormake` if not installed. NOTE: menuconfig was not navigatable with colormake
alias :q="exit"
# i3wm not in use now.
# alias eic="$EDITOR $HOME/.config/i3/config"
# alias eib="$EDITOR $HOME/.config/i3/i3blocks.conf"
alias sdn="shutdown now"
alias update="sudo apt update"
alias upgrade="sudo apt upgrade"
alias clean="sudo apt clean"
alias autoclean="sudo apt autoclean"
alias autoremove="sudo apt autoremove"
alias open="xdg-open"
alias untar="tar -xvf"

# Close terminal with `exit' if previous command was success.
alias se='[ $? = 0 ] && exit'

# Find and save location of all git repositories in $HOME. Useful with dmenu.
alias gitdbupdate="find $HOME/ -regex .*/\.git$ 2>/dev/null > $HOME/.tmp/gitfiles"

# Enable/Disable mouse and touchpad.
alias te="xinput set-prop \"Synaptics TM3276-022\" \"Device Enabled\" 1"
alias td="xinput set-prop \"Synaptics TM3276-022\" \"Device Enabled\" 0"
alias me="xinput set-prop \"PixArt Lenovo USB Optical Mouse\" \"Device Enabled\" 1"
alias md="xinput set-prop \"PixArt Lenovo USB Optical Mouse\" \"Device Enabled\" 0"

# enable color support of ls and also add handy aliases
if [ -x /usr/bin/dircolors ]; then
    test -r $HOME/.dircolors && eval "$(dircolors -b $HOME/.dircolors)" || eval "$(dircolors -b)"
    alias ls='ls --color=auto'
    #alias dir='dir --color=auto'
    #alias vdir='vdir --color=auto'

    alias grep='grep --color=auto --exclude=cscope* --exclude=tags'
    alias fgrep='fgrep --color=auto --exclude=cscope* --exclude=tags'
    alias egrep='egrep --color=auto --exclude=cscope* --exclude=tags'
fi

# some more ls aliases
alias ll='ls -AltF'
alias la='ls -A'
alias l='ls -CF'

# Add an "alert" alias for long running commands.  Use like so:
#   sleep 10; alert
alias alert='notify-send --urgency=low -i "$([ $? = 0 ] && echo terminal || echo error)" "$(history|tail -n1|sed -e '\''s/^\s*[0-9]\+\s*//;s/[;&|]\s*alert$//'\'')"'


# functions

# Copy output of a command. To copy with new line, give option `-n'.
copy() {
    [ "$1" = "-n" ] || xargs echo -n | xclip -sel c ||
        xclip -sel c
}

# `dict` will always open in less
meaning() { dict "$@" | less; }

# Search file in fzf and open in Vim
ef() {
    if $(command -v fzf >/dev/null 2>&1); then
        IP="$(fzf)"
        [ -n "$IP" ] && vim "$IP"
    else
        echo "Error: fzf not found."
        return 1
    fi
}

# Update system smartly.
up-to-date() {

    # Launch commands as subprocess so that single  will stop whole process.
    (
        sudo apt update
        sudo apt upgrade "$1"
        sudo apt autoremove "$1"
        sudo apt autoclean
        sudo apt clean

        # Find and save location of all git repositories in $HOME. Useful with dmenu.
        find $HOME/ -regex .*/\.git$ 2>/dev/null > $HOME/.tmp/gitfiles
        sudo updatedb
    )
    [ "$2" != "-n" ] && exit || return 0

}

# Combined mkdir and cd
mkcdir() { mkdir "$@" && cd "$@"; }

# Tree will open in less
ltree() { tree -C "$@" | less -R; }

# Display size summary in human readable format.
sz() { du -sh "$@"; }

# Combined cd and ls for a directory or if file, open in default EDITOR.
cds() { cd "$@" 2>/dev/null && ls -CF || $EDITOR "$@"; }

# Copy full path of last edited file or given file.
ol() {
    # If any input is provided then go to that directory
    if [ $1 ]; then

        # If the provided input if a file, then copy path of that
        # file.
        if [ -f $1 ]; then
            echo -n $(realpath $1) | xclip -sel c
            echo "\"$(basename $1)\" copied to clipboard."
            return 0

            # If input is not a file, copy last edited file in that
            # directory.
        else
            FILE="$(realpath $1/$(ls -t $1 | head -n 1))"
        fi
        # If no input is provided, copy last updated file/directory in
        # current directory
    else
        FILE="$(realpath $(ls -t | head -n 1))"
    fi &&
        echo -n $FILE | xclip -sel c &&
        echo "$( basename $FILE)"
}

# Open emacsclient for a window hiding terminal if `devour' is presetn or
# detaching process from terminal
em() { devour emacsclient -c "$@" || setsid emacsclient -c "$@"; }

# Edit suckless config files (config.h).
esc() { [ $1 ] && cd $HOME/pnl/github/$1; $EDITOR config.h; }

# Build suckelss apps.
bsa() {
    [ $1 ] && cd $HOME/pnl/github/$1
    sudo make uninstall >/dev/null &&
        sudo make clean install >/dev/null &&
        echo "$1 build successful." &&
        echo "Last built on commit ID $(git log |head -n1 | cut -f2 -d ' ') with changes:" > .build &&
        git diff >> .build &&
        git diff --cached >> .build
}

# `make' with style B-).
m() {
    clear
    echo 'make >/dev/null'
     ls sdkconfig >/dev/null 2>&1 || make defconfig >/dev/null
    make -j32 >/dev/null && echo 'Built successfully with make.' ||
            { RETURN="$?" && echo 'Build with make failed.' && return $RETURN; }
}

# Process tree in less
ptr() { pstree "$@" | less; }

# alias for git
alias gitgraph="git log --graph --decorate --oneline --all"
alias s="git status 2>/dev/null || ls --color=auto"
alias sub="git submodule update --init --recursive --progress"
alias dinit="git submodule deinit --all -f"
alias gcm="git checkout master"
alias gcp="git branch | sed -n 's/\* \(.*\)/\1/p' | xargs echo -n | xclip -sel c && echo Branch copied to clipboard."

# Alias for opening files in less with default syntax hilighting. Run this alias to color files in less.
alias lesc='LESS="-R" LESSOPEN="|pygmentize -g %s" less'
