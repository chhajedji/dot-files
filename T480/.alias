#!/bin/bash

[ -n "$EDITOR" ] || EDITOR="vi"

# General alias

alias ea="$EDITOR $HOME/.alias"
alias ev="$EDITOR $HOME/.vimrc"
alias ebp="$EDITOR $HOME/.bashrc"
alias ep="$EDITOR $HOME/.profile"
alias eec="$EDITOR $HOME/.espconfig"
alias SE="source $HOME/.espconfig"
alias exr="$EDITOR $HOME/.Xresources"
alias SB="source $HOME/.bashrc"
alias SA="source $HOME/.alias"
alias p2="python2"
alias p3="python3 -q"
alias v="vim +"
alias nv="nvim +"
alias make="make -j32"
# alias make="colormake"       # `sudo apt install colormake` if not installed. NOTE: menuconfig was not navigatable with colormake
alias m="clear;echo 'make >/dev/null';printenv IDF_PATH >/dev/null && make defconfig >/dev/null; make -j32 >/dev/null && echo 'Built successfully with make.' || echo 'Build with make failed.'"
alias :q="exit"
alias pforce="git push --force-with-lease"    # force push with lease
alias eic="$EDITOR $HOME/.config/i3/config"
alias eib="$EDITOR $HOME/.config/i3/i3blocks.conf"
alias sdn="shutdown now"
alias update="sudo apt update"
alias upgrade="sudo apt upgrade"
alias clean="sudo apt clean"
alias autoclean="sudo apt autoclean"
alias autoremove="sudo apt autoremove"
alias open="xdg-open"
alias untar="tar -xvf"

# Find and save all git repositories in $HOME/.
alias gitdbupdate="find $HOME/ -regex .*/\.git$ 2>/dev/null > $HOME/.tmp/gitfiles"

# Copy without newline.
alias copy='xargs echo -n |xclip -sel c'

# Enable/Disable mouse and touchpad.
alias te="xinput set-prop \"Synaptics TM3276-022\" \"Device Enabled\" 1"
alias td="xinput set-prop \"Synaptics TM3276-022\" \"Device Enabled\" 0"
alias me="xinput set-prop \"PixArt Lenovo USB Optical Mouse\" \"Device Enabled\" 1"
alias md="xinput set-prop \"PixArt Lenovo USB Optical Mouse\" \"Device Enabled\" 0"

# enable color support of ls and also add handy aliases
if [ -x /usr/bin/dircolors ]; then
    test -r $HOME/.dircolors && eval "$(dircolors -b $HOME/.dircolors)" || eval "$(dircolors -b)"
    alias ls='ls --color=auto'
    #alias dir='dir --color=auto'
    #alias vdir='vdir --color=auto'

    alias grep='grep --color=auto --exclude=cscope* --exclude=tags'
    alias fgrep='fgrep --color=auto --exclude=cscope* --exclude=tags'
    alias egrep='egrep --color=auto --exclude=cscope* --exclude=tags'
fi

# some more ls aliases
alias ll='ls -AtlF'
alias la='ls -A'
alias l='ls -CF'

# Add an "alert" alias for long running commands.  Use like so:
#   sleep 10; alert
alias alert='notify-send --urgency=low -i "$([ $? = 0 ] && echo terminal || echo error)" "$(history|tail -n1|sed -e '\''s/^\s*[0-9]\+\s*//;s/[;&|]\s*alert$//'\'')"'


# functions

# `dict` will always open in less
meaning() { dict "$@" | less; }

# Update system smartly.
up-to-date() {

# Launch commands as subprocess so that single  will stop whole process.
    (
     sudo apt update
     sudo apt upgrade "$1"
     sudo apt autoremove "$1"
     sudo apt autoclean
     sudo apt clean

     # Update database for all git repos.
     find $HOME/ -regex .*/\.git$ 2>/dev/null > $HOME/.tmp/gitfiles
    sudo updatedb
    )
    exit
}

# Combined mkdir and cd
mkcdir() { mkdir "$@" && cd "$@"; }

# Tree will open in less
ltree() { tree -C "$@" | less -R; }

# Modified git diff
gd() { git diff --color=always "$@" | less -R; }

# Similarly modified git log
gl() { git log --color=always "$@" | less -R; }

# Display size summary in human readable format.
sz() { du -sh "$@"; }

# Combined cd and ls for a directory or if file, open in Neovim.
cds() { cd "$@" 2>/dev/null && ls -CF || $EDITOR "$@"; }

# Copy full path of last edited file.
ol() {
    FILE="$(realpath $(ls -t | head -n 1))" &&
        echo -n $FILE | xclip -sel c &&
        echo "\"$( basename $FILE)\" copied to clipboard."
}

# Open emacsclient for a window hiding terminal if `devour' is presetn or
# detaching process from terminal
em() { devour emacsclient -c "$@" || setsid emacsclient -c "$@"; }

# Edit suckless config files (config.h).
esc() { [ $1 ] && cd $HOME/pnl/github/$1; $EDITOR config.h; }

# Build suckelss apps.
bsa() {
    [ $1 ] && cd $HOME/pnl/github/$1
        sudo make uninstall >/dev/null &&
            sudo make clean install >/dev/null &&
            echo "$1 build successful." &&
            echo "Last built on commit ID $(git log |head -n1 | cut -f2 -d ' ') with changes:" > .build &&
            git diff >> .build &&
            git diff --cached >> .build
}

# Process tree in less
ptr() { pstree "$@" | less; }

# alias for git
alias gitgraph="git log --graph --decorate --oneline --all"
alias s="git status 2>/dev/null || ls --color=auto"
alias sub="git submodule update --init --recursive --progress"
alias dinit="git submodule deinit --all -f"
alias gcm="git checkout master"
alias gcp="git branch | sed -n 's/\* \(.*\)/\1/p' | xargs echo -n | xclip -sel c && echo Branch copied to clipboard."

# Alias for opening files in less with default syntax hilighting. Run this alias to color files in less.
alias lesc='LESS="-R" LESSOPEN="|pygmentize -g %s" less'
